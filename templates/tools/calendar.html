{% extends "base.html" %}

{% block title %}Calendar - Nature Zimbabwe{% endblock %}

{% block content %}
<div class="container py-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('home') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('tools_home') }}">Tools</a></li>
            <li class="breadcrumb-item active">Calendar</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="text-center mb-4">
                <h1 class="text-nature-green mb-3">ðŸ“… Calendar Viewer</h1>
                <p class="lead">View monthly calendars and track important dates</p>
            </div>

            <div class="nature-card">
                <div class="card-body">
                    <!-- Calendar Controls -->
                    <div class="row align-items-center mb-4">
                        <div class="col-md-4">
                            <button id="prevBtn" class="btn btn-nature-outline">
                                <i class="fas fa-chevron-left me-2"></i>Previous
                            </button>
                        </div>
                        <div class="col-md-4 text-center">
                            <h3 id="currentMonth" class="text-nature-green mb-0">January 2024</h3>
                        </div>
                        <div class="col-md-4 text-end">
                            <button id="nextBtn" class="btn btn-nature-outline">
                                Next <i class="fas fa-chevron-right ms-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Quick Navigation -->
                    <div class="text-center mb-4">
                        <button id="todayBtn" class="btn btn-nature btn-sm me-2">
                            <i class="fas fa-calendar-day me-2"></i>Today
                        </button>
                        <div class="btn-group" role="group">
                            <select id="monthSelect" class="form-select form-select-sm me-2" style="width: auto;">
                                <option value="0">January</option>
                                <option value="1">February</option>
                                <option value="2">March</option>
                                <option value="3">April</option>
                                <option value="4">May</option>
                                <option value="5">June</option>
                                <option value="6">July</option>
                                <option value="7">August</option>
                                <option value="8">September</option>
                                <option value="9">October</option>
                                <option value="10">November</option>
                                <option value="11">December</option>
                            </select>
                            <select id="yearSelect" class="form-select form-select-sm" style="width: auto;">
                                <!-- Years populated by JavaScript -->
                            </select>
                        </div>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="calendar-container">
                        <div class="calendar-grid">
                            <!-- Calendar header -->
                            <div class="calendar-header">
                                <div class="day-header">Sun</div>
                                <div class="day-header">Mon</div>
                                <div class="day-header">Tue</div>
                                <div class="day-header">Wed</div>
                                <div class="day-header">Thu</div>
                                <div class="day-header">Fri</div>
                                <div class="day-header">Sat</div>
                            </div>
                            <!-- Calendar days -->
                            <div id="calendarDays" class="calendar-days">
                                <!-- Days populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Selected Date Info -->
                    <div id="dateInfo" class="mt-4 text-center" style="display: none;">
                        <div class="alert alert-info">
                            <h5 id="selectedDate" class="mb-2"></h5>
                            <div id="dateDetails" class="small"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Features -->
            <div class="nature-card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">ðŸ“‹ Calendar Features</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-nature-brown">Navigation</h6>
                            <ul class="small">
                                <li>Navigate between months and years</li>
                                <li>Quick jump to current date</li>
                                <li>Select specific month/year</li>
                                <li>Click on any date for details</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-nature-brown">Information</h6>
                            <ul class="small">
                                <li>Day of week for any date</li>
                                <li>Week numbers</li>
                                <li>Current date highlighting</li>
                                <li>Weekend highlighting</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="text-center mt-4">
                <a href="{{ url_for('tools_home') }}" class="btn btn-nature-outline">
                    <i class="fas fa-arrow-left me-2"></i>Back to Tools
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.calendar-container {
    max-width: 100%;
    margin: 0 auto;
}

.calendar-grid {
    border: 1px solid var(--nature-green);
    border-radius: 8px;
    overflow: hidden;
}

.calendar-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    background: var(--nature-green);
}

.day-header {
    padding: 12px 8px;
    text-align: center;
    font-weight: bold;
    color: white;
    border-right: 1px solid rgba(255,255,255,0.2);
}

.day-header:last-child {
    border-right: none;
}

.calendar-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
}

.calendar-day {
    aspect-ratio: 1;
    border: 1px solid #e0e0e0;
    padding: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    min-height: 60px;
}

.calendar-day:hover {
    background-color: var(--nature-beige);
}

.calendar-day.other-month {
    color: #ccc;
    background-color: #f8f9fa;
}

.calendar-day.today {
    background-color: var(--nature-light-green);
    color: white;
    font-weight: bold;
}

.calendar-day.selected {
    background-color: var(--nature-gold);
    color: white;
}

.calendar-day.weekend {
    background-color: rgba(255, 193, 7, 0.1);
}

.day-number {
    font-size: 1.1rem;
    font-weight: 500;
}

@media (max-width: 768px) {
    .calendar-day {
        min-height: 50px;
        padding: 4px;
    }
    
    .day-number {
        font-size: 0.9rem;
    }
    
    .day-header {
        padding: 8px 4px;
        font-size: 0.9rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const todayBtn = document.getElementById('todayBtn');
    const currentMonth = document.getElementById('currentMonth');
    const monthSelect = document.getElementById('monthSelect');
    const yearSelect = document.getElementById('yearSelect');
    const calendarDays = document.getElementById('calendarDays');
    const dateInfo = document.getElementById('dateInfo');
    const selectedDate = document.getElementById('selectedDate');
    const dateDetails = document.getElementById('dateDetails');
    
    let currentDate = new Date();
    let selectedDay = null;
    
    const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    
    const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    
    function initializeCalendar() {
        // Populate year select
        const currentYear = new Date().getFullYear();
        for (let year = currentYear - 10; year <= currentYear + 10; year++) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            if (year === currentYear) option.selected = true;
            yearSelect.appendChild(option);
        }
        
        updateCalendar();
    }
    
    function updateCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        // Update header
        currentMonth.textContent = `${monthNames[month]} ${year}`;
        monthSelect.value = month;
        yearSelect.value = year;
        
        // Clear previous days
        calendarDays.innerHTML = '';
        
        // Get first day of month and number of days
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        // Add previous month's trailing days
        const prevMonth = new Date(year, month - 1, 0);
        const prevMonthDays = prevMonth.getDate();
        
        for (let i = startingDayOfWeek - 1; i >= 0; i--) {
            const dayNum = prevMonthDays - i;
            const dayElement = createDayElement(dayNum, true, new Date(year, month - 1, dayNum));
            calendarDays.appendChild(dayElement);
        }
        
        // Add current month's days
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = createDayElement(day, false, new Date(year, month, day));
            calendarDays.appendChild(dayElement);
        }
        
        // Add next month's leading days
        const totalCells = calendarDays.children.length;
        const remainingCells = 42 - totalCells; // 6 rows Ã— 7 days
        
        for (let day = 1; day <= remainingCells; day++) {
            const dayElement = createDayElement(day, true, new Date(year, month + 1, day));
            calendarDays.appendChild(dayElement);
        }
    }
    
    function createDayElement(dayNum, isOtherMonth, date) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        
        if (isOtherMonth) {
            dayElement.classList.add('other-month');
        }
        
        // Check if it's today
        const today = new Date();
        if (date.toDateString() === today.toDateString()) {
            dayElement.classList.add('today');
        }
        
        // Check if it's weekend
        if (date.getDay() === 0 || date.getDay() === 6) {
            dayElement.classList.add('weekend');
        }
        
        dayElement.innerHTML = `<div class="day-number">${dayNum}</div>`;
        
        dayElement.addEventListener('click', () => selectDate(date, dayElement));
        
        return dayElement;
    }
    
    function selectDate(date, element) {
        // Remove previous selection
        document.querySelectorAll('.calendar-day.selected').forEach(day => {
            day.classList.remove('selected');
        });
        
        // Add selection to clicked day
        element.classList.add('selected');
        selectedDay = date;
        
        // Show date info
        showDateInfo(date);
    }
    
    function showDateInfo(date) {
        const dayName = dayNames[date.getDay()];
        const monthName = monthNames[date.getMonth()];
        const dayNum = date.getDate();
        const year = date.getFullYear();
        
        selectedDate.textContent = `${dayName}, ${monthName} ${dayNum}, ${year}`;
        
        // Calculate additional info
        const dayOfYear = Math.floor((date - new Date(year, 0, 0)) / (1000 * 60 * 60 * 24));
        const weekNumber = Math.ceil(dayOfYear / 7);
        
        let details = `Day ${dayOfYear} of ${year} â€¢ Week ${weekNumber}`;
        
        // Add special info
        if (date.getDay() === 0 || date.getDay() === 6) {
            details += ' â€¢ Weekend';
        }
        
        if (date.toDateString() === new Date().toDateString()) {
            details += ' â€¢ Today';
        }
        
        dateDetails.textContent = details;
        dateInfo.style.display = 'block';
    }
    
    function goToPreviousMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        updateCalendar();
    }
    
    function goToNextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        updateCalendar();
    }
    
    function goToToday() {
        currentDate = new Date();
        updateCalendar();
        
        // Auto-select today
        setTimeout(() => {
            const todayElement = document.querySelector('.calendar-day.today');
            if (todayElement) {
                selectDate(new Date(), todayElement);
            }
        }, 100);
    }
    
    function goToSelectedMonth() {
        const month = parseInt(monthSelect.value);
        const year = parseInt(yearSelect.value);
        currentDate = new Date(year, month, 1);
        updateCalendar();
    }
    
    // Event listeners
    prevBtn.addEventListener('click', goToPreviousMonth);
    nextBtn.addEventListener('click', goToNextMonth);
    todayBtn.addEventListener('click', goToToday);
    monthSelect.addEventListener('change', goToSelectedMonth);
    yearSelect.addEventListener('change', goToSelectedMonth);
    
    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        switch(e.key) {
            case 'ArrowLeft':
                goToPreviousMonth();
                break;
            case 'ArrowRight':
                goToNextMonth();
                break;
            case 'Home':
                goToToday();
                break;
        }
    });
    
    // Initialize
    initializeCalendar();
});
</script>
{% endblock %}
