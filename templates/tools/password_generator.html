{% extends "base.html" %}

{% block title %}Password Generator - Nature Zimbabwe{% endblock %}

{% block content %}
<div class="container py-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('home') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('tools_home') }}">Tools</a></li>
            <li class="breadcrumb-item active">Password Generator</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="text-center mb-4">
                <h1 class="text-nature-green mb-3">üîê Password Generator</h1>
                <p class="lead">Generate secure passwords with customizable options</p>
            </div>

            <div class="nature-card">
                <div class="card-body">
                    <!-- Password Settings -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="passwordLength" class="form-label">Password Length: <span id="lengthValue">12</span></label>
                            <input type="range" id="passwordLength" class="form-range" min="4" max="50" value="12">
                        </div>
                        <div class="col-md-6">
                            <label for="passwordCount" class="form-label">Number of Passwords:</label>
                            <select id="passwordCount" class="form-select">
                                <option value="1" selected>1 Password</option>
                                <option value="3">3 Passwords</option>
                                <option value="5">5 Passwords</option>
                                <option value="10">10 Passwords</option>
                            </select>
                        </div>
                    </div>

                    <!-- Character Options -->
                    <div class="mb-4">
                        <h6 class="text-nature-brown mb-3">Include Characters:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeUppercase" checked>
                                    <label class="form-check-label" for="includeUppercase">
                                        Uppercase Letters (A-Z)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeLowercase" checked>
                                    <label class="form-check-label" for="includeLowercase">
                                        Lowercase Letters (a-z)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeNumbers" checked>
                                    <label class="form-check-label" for="includeNumbers">
                                        Numbers (0-9)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeSymbols">
                                    <label class="form-check-label" for="includeSymbols">
                                        Symbols (!@#$%^&*)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Options -->
                    <div class="mb-4">
                        <h6 class="text-nature-brown mb-3">Additional Options:</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="excludeSimilar" checked>
                            <label class="form-check-label" for="excludeSimilar">
                                Exclude similar characters (0, O, l, I, 1)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="excludeAmbiguous">
                            <label class="form-check-label" for="excludeAmbiguous">
                                Exclude ambiguous characters ({ } [ ] ( ) / \ ' " ` ~ , ; . < >)
                            </label>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="text-center mb-4">
                        <button id="generateBtn" class="btn btn-nature btn-lg">
                            <i class="fas fa-key me-2"></i>Generate Password(s)
                        </button>
                    </div>

                    <!-- Generated Passwords -->
                    <div id="passwordsContainer" style="display: none;">
                        <h6 class="text-nature-brown mb-3">Generated Passwords:</h6>
                        <div id="passwordsList">
                            <!-- Passwords will be displayed here -->
                        </div>
                        <div class="text-center mt-3">
                            <button id="copyAllBtn" class="btn btn-nature-outline btn-sm me-2">
                                <i class="fas fa-copy me-2"></i>Copy All
                            </button>
                            <button id="clearBtn" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-trash me-2"></i>Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Password Strength Tips -->
            <div class="nature-card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">üõ°Ô∏è Password Security Tips</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-nature-brown">Strong Password Guidelines</h6>
                            <ul class="small">
                                <li>Use at least 12 characters</li>
                                <li>Mix uppercase and lowercase letters</li>
                                <li>Include numbers and symbols</li>
                                <li>Avoid dictionary words</li>
                                <li>Don't use personal information</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-nature-brown">Best Practices</h6>
                            <ul class="small">
                                <li>Use unique passwords for each account</li>
                                <li>Consider using a password manager</li>
                                <li>Enable two-factor authentication</li>
                                <li>Change passwords regularly</li>
                                <li>Never share passwords</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="text-center mt-4">
                <a href="{{ url_for('tools_home') }}" class="btn btn-nature-outline">
                    <i class="fas fa-arrow-left me-2"></i>Back to Tools
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.password-item {
    background: var(--nature-beige);
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.password-text {
    font-family: 'Courier New', monospace;
    font-size: 1.1rem;
    font-weight: bold;
    color: var(--nature-green);
    word-break: break-all;
    flex-grow: 1;
    margin-right: 15px;
}

.password-actions {
    display: flex;
    gap: 5px;
}

.strength-indicator {
    height: 8px;
    border-radius: 4px;
    margin-top: 5px;
    transition: all 0.3s ease;
}

.strength-weak { background-color: #dc3545; }
.strength-fair { background-color: #ffc107; }
.strength-good { background-color: #28a745; }
.strength-strong { background-color: #007bff; }

.copy-btn {
    transition: all 0.3s ease;
}

.copy-btn.copied {
    background-color: var(--nature-light-green);
    color: white;
    border-color: var(--nature-light-green);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordLength = document.getElementById('passwordLength');
    const lengthValue = document.getElementById('lengthValue');
    const passwordCount = document.getElementById('passwordCount');
    const includeUppercase = document.getElementById('includeUppercase');
    const includeLowercase = document.getElementById('includeLowercase');
    const includeNumbers = document.getElementById('includeNumbers');
    const includeSymbols = document.getElementById('includeSymbols');
    const excludeSimilar = document.getElementById('excludeSimilar');
    const excludeAmbiguous = document.getElementById('excludeAmbiguous');
    const generateBtn = document.getElementById('generateBtn');
    const passwordsContainer = document.getElementById('passwordsContainer');
    const passwordsList = document.getElementById('passwordsList');
    const copyAllBtn = document.getElementById('copyAllBtn');
    const clearBtn = document.getElementById('clearBtn');
    
    // Character sets
    const charSets = {
        uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
        lowercase: 'abcdefghijklmnopqrstuvwxyz',
        numbers: '0123456789',
        symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?'
    };
    
    const similarChars = '0Ol1I';
    const ambiguousChars = '{}[]()\/\\\'"`~,;.<>';
    
    // Update length display
    passwordLength.addEventListener('input', function() {
        lengthValue.textContent = this.value;
    });
    
    function generatePassword(length, options) {
        let charset = '';
        
        if (options.includeUppercase) charset += charSets.uppercase;
        if (options.includeLowercase) charset += charSets.lowercase;
        if (options.includeNumbers) charset += charSets.numbers;
        if (options.includeSymbols) charset += charSets.symbols;
        
        if (options.excludeSimilar) {
            charset = charset.split('').filter(char => !similarChars.includes(char)).join('');
        }
        
        if (options.excludeAmbiguous) {
            charset = charset.split('').filter(char => !ambiguousChars.includes(char)).join('');
        }
        
        if (charset === '') {
            throw new Error('No character types selected');
        }
        
        let password = '';
        for (let i = 0; i < length; i++) {
            password += charset.charAt(Math.floor(Math.random() * charset.length));
        }
        
        return password;
    }
    
    function calculateStrength(password) {
        let score = 0;
        
        // Length bonus
        if (password.length >= 8) score += 1;
        if (password.length >= 12) score += 1;
        if (password.length >= 16) score += 1;
        
        // Character variety
        if (/[a-z]/.test(password)) score += 1;
        if (/[A-Z]/.test(password)) score += 1;
        if (/[0-9]/.test(password)) score += 1;
        if (/[^A-Za-z0-9]/.test(password)) score += 1;
        
        // Complexity bonus
        if (password.length >= 12 && score >= 4) score += 1;
        
        if (score <= 2) return 'weak';
        if (score <= 4) return 'fair';
        if (score <= 6) return 'good';
        return 'strong';
    }
    
    function createPasswordElement(password) {
        const strength = calculateStrength(password);
        const strengthText = strength.charAt(0).toUpperCase() + strength.slice(1);
        
        const passwordDiv = document.createElement('div');
        passwordDiv.className = 'password-item';
        passwordDiv.innerHTML = `
            <div class="flex-grow-1">
                <div class="password-text">${password}</div>
                <div class="d-flex align-items-center">
                    <small class="text-muted me-2">Strength: ${strengthText}</small>
                    <div class="strength-indicator strength-${strength}" style="width: 100px;"></div>
                </div>
            </div>
            <div class="password-actions">
                <button class="btn btn-outline-secondary btn-sm copy-btn" onclick="copyPassword(this, '${password}')">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
        `;
        
        return passwordDiv;
    }
    
    function generatePasswords() {
        try {
            const options = {
                includeUppercase: includeUppercase.checked,
                includeLowercase: includeLowercase.checked,
                includeNumbers: includeNumbers.checked,
                includeSymbols: includeSymbols.checked,
                excludeSimilar: excludeSimilar.checked,
                excludeAmbiguous: excludeAmbiguous.checked
            };
            
            const length = parseInt(passwordLength.value);
            const count = parseInt(passwordCount.value);
            
            passwordsList.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const password = generatePassword(length, options);
                const passwordElement = createPasswordElement(password);
                passwordsList.appendChild(passwordElement);
            }
            
            passwordsContainer.style.display = 'block';
            
        } catch (error) {
            alert('Error: ' + error.message);
        }
    }
    
    function copyPassword(button, password) {
        navigator.clipboard.writeText(password).then(() => {
            const originalIcon = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i>';
            button.classList.add('copied');
            
            setTimeout(() => {
                button.innerHTML = originalIcon;
                button.classList.remove('copied');
            }, 1500);
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = password;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            const originalIcon = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i>';
            button.classList.add('copied');
            
            setTimeout(() => {
                button.innerHTML = originalIcon;
                button.classList.remove('copied');
            }, 1500);
        });
    }
    
    function copyAllPasswords() {
        const passwords = Array.from(document.querySelectorAll('.password-text'))
            .map(el => el.textContent)
            .join('\n');
        
        navigator.clipboard.writeText(passwords).then(() => {
            const originalText = copyAllBtn.innerHTML;
            copyAllBtn.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
            copyAllBtn.classList.add('copied');
            
            setTimeout(() => {
                copyAllBtn.innerHTML = originalText;
                copyAllBtn.classList.remove('copied');
            }, 1500);
        });
    }
    
    function clearPasswords() {
        passwordsContainer.style.display = 'none';
        passwordsList.innerHTML = '';
    }
    
    // Make functions globally available
    window.copyPassword = copyPassword;
    
    // Event listeners
    generateBtn.addEventListener('click', generatePasswords);
    copyAllBtn.addEventListener('click', copyAllPasswords);
    clearBtn.addEventListener('click', clearPasswords);
    
    // Keyboard shortcut
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            generatePasswords();
        }
    });
});
</script>
{% endblock %}
