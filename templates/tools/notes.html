{% extends "base.html" %}

{% block title %}Notes App - Nature Zimbabwe{% endblock %}

{% block content %}
<div class="container py-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('home') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('tools_home') }}">Tools</a></li>
            <li class="breadcrumb-item active">Notes App</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-4">
            <!-- Notes List -->
            <div class="nature-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">üìù My Notes</h5>
                    <button id="newNoteBtn" class="btn btn-nature btn-sm">
                        <i class="fas fa-plus me-1"></i>New
                    </button>
                </div>
                <div class="card-body p-0">
                    <div id="notesList" class="notes-list">
                        <!-- Notes will be populated here -->
                    </div>
                    <div id="emptyNotes" class="text-center p-4">
                        <i class="fas fa-sticky-note fa-2x text-muted mb-2"></i>
                        <p class="text-muted small">No notes yet. Create your first note!</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <!-- Note Editor -->
            <div class="nature-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <input type="text" id="noteTitle" class="form-control border-0 bg-transparent" 
                           placeholder="Note title..." style="font-weight: 600;">
                    <div class="note-actions">
                        <button id="saveNoteBtn" class="btn btn-nature btn-sm me-2">
                            <i class="fas fa-save me-1"></i>Save
                        </button>
                        <button id="deleteNoteBtn" class="btn btn-outline-danger btn-sm" style="display: none;">
                            <i class="fas fa-trash me-1"></i>Delete
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <textarea id="noteContent" class="form-control border-0" 
                              placeholder="Start writing your note here..." 
                              rows="15" style="resize: none;"></textarea>
                    
                    <div class="mt-3 d-flex justify-content-between align-items-center">
                        <small class="text-muted" id="noteInfo">
                            <span id="wordCount">0 words</span> ‚Ä¢ 
                            <span id="charCount">0 characters</span>
                        </small>
                        <small class="text-muted" id="lastSaved"></small>
                    </div>
                </div>
            </div>

            <!-- Welcome Message -->
            <div id="welcomeMessage" class="nature-card">
                <div class="card-body text-center py-5">
                    <i class="fas fa-edit fa-3x text-nature-green mb-3"></i>
                    <h4 class="text-nature-green">Welcome to Notes</h4>
                    <p class="text-muted">Create and organize your thoughts, ideas, and important information. Your notes are automatically saved locally in your browser.</p>
                    <button class="btn btn-nature" onclick="document.getElementById('newNoteBtn').click()">
                        <i class="fas fa-plus me-2"></i>Create Your First Note
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.notes-list {
    max-height: 400px;
    overflow-y: auto;
}

.note-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.note-item:hover {
    background-color: var(--nature-beige);
}

.note-item.active {
    background-color: var(--nature-light-green);
    color: white;
}

.note-item.active .note-preview {
    color: rgba(255, 255, 255, 0.8);
}

.note-title {
    font-weight: 600;
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.note-preview {
    font-size: 0.85rem;
    color: #6c757d;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.note-date {
    font-size: 0.75rem;
    color: #6c757d;
    margin-top: 5px;
}

.note-item.active .note-date {
    color: rgba(255, 255, 255, 0.7);
}

#noteContent {
    font-family: 'Georgia', serif;
    line-height: 1.6;
}

#noteTitle {
    font-size: 1.25rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const newNoteBtn = document.getElementById('newNoteBtn');
    const notesList = document.getElementById('notesList');
    const emptyNotes = document.getElementById('emptyNotes');
    const welcomeMessage = document.getElementById('welcomeMessage');
    const noteTitle = document.getElementById('noteTitle');
    const noteContent = document.getElementById('noteContent');
    const saveNoteBtn = document.getElementById('saveNoteBtn');
    const deleteNoteBtn = document.getElementById('deleteNoteBtn');
    const wordCount = document.getElementById('wordCount');
    const charCount = document.getElementById('charCount');
    const lastSaved = document.getElementById('lastSaved');
    
    let notes = [];
    let currentNoteId = null;
    let autoSaveTimeout = null;
    
    // Load notes from localStorage
    function loadNotes() {
        const savedNotes = localStorage.getItem('notesApp');
        if (savedNotes) {
            notes = JSON.parse(savedNotes);
        }
        renderNotesList();
        
        if (notes.length === 0) {
            showWelcomeMessage();
        }
    }
    
    // Save notes to localStorage
    function saveNotes() {
        localStorage.setItem('notesApp', JSON.stringify(notes));
    }
    
    // Show welcome message
    function showWelcomeMessage() {
        welcomeMessage.style.display = 'block';
        deleteNoteBtn.style.display = 'none';
        noteTitle.value = '';
        noteContent.value = '';
        currentNoteId = null;
        updateCounts();
    }
    
    // Hide welcome message
    function hideWelcomeMessage() {
        welcomeMessage.style.display = 'none';
    }
    
    // Create new note
    function createNewNote() {
        const note = {
            id: Date.now(),
            title: 'Untitled Note',
            content: '',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
        
        notes.unshift(note);
        saveNotes();
        renderNotesList();
        selectNote(note.id);
        hideWelcomeMessage();
        noteTitle.focus();
    }
    
    // Select note
    function selectNote(id) {
        const note = notes.find(n => n.id === id);
        if (!note) return;
        
        currentNoteId = id;
        noteTitle.value = note.title;
        noteContent.value = note.content;
        deleteNoteBtn.style.display = 'inline-block';
        
        // Update active state in list
        document.querySelectorAll('.note-item').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelector(`[data-note-id="${id}"]`).classList.add('active');
        
        updateCounts();
        hideWelcomeMessage();
    }
    
    // Save current note
    function saveCurrentNote() {
        if (!currentNoteId) return;
        
        const note = notes.find(n => n.id === currentNoteId);
        if (!note) return;
        
        note.title = noteTitle.value.trim() || 'Untitled Note';
        note.content = noteContent.value;
        note.updatedAt = new Date().toISOString();
        
        saveNotes();
        renderNotesList();
        
        lastSaved.textContent = 'Saved at ' + new Date().toLocaleTimeString();
        setTimeout(() => {
            lastSaved.textContent = '';
        }, 3000);
    }
    
    // Delete current note
    function deleteCurrentNote() {
        if (!currentNoteId) return;
        
        if (confirm('Are you sure you want to delete this note?')) {
            notes = notes.filter(n => n.id !== currentNoteId);
            saveNotes();
            renderNotesList();
            
            if (notes.length === 0) {
                showWelcomeMessage();
            } else {
                selectNote(notes[0].id);
            }
        }
    }
    
    // Render notes list
    function renderNotesList() {
        if (notes.length === 0) {
            notesList.style.display = 'none';
            emptyNotes.style.display = 'block';
            return;
        }
        
        notesList.style.display = 'block';
        emptyNotes.style.display = 'none';
        
        notesList.innerHTML = '';
        
        notes.forEach(note => {
            const noteItem = document.createElement('div');
            noteItem.className = 'note-item';
            noteItem.dataset.noteId = note.id;
            
            const preview = note.content.substring(0, 50);
            const date = new Date(note.updatedAt).toLocaleDateString();
            
            noteItem.innerHTML = `
                <div class="note-title">${note.title}</div>
                <div class="note-preview">${preview}${note.content.length > 50 ? '...' : ''}</div>
                <div class="note-date">${date}</div>
            `;
            
            noteItem.addEventListener('click', () => selectNote(note.id));
            notesList.appendChild(noteItem);
        });
    }
    
    // Update word and character counts
    function updateCounts() {
        const content = noteContent.value;
        const words = content.trim() ? content.trim().split(/\s+/).length : 0;
        const chars = content.length;
        
        wordCount.textContent = `${words} word${words !== 1 ? 's' : ''}`;
        charCount.textContent = `${chars} character${chars !== 1 ? 's' : ''}`;
    }
    
    // Auto-save functionality
    function scheduleAutoSave() {
        if (autoSaveTimeout) {
            clearTimeout(autoSaveTimeout);
        }
        
        autoSaveTimeout = setTimeout(() => {
            if (currentNoteId) {
                saveCurrentNote();
            }
        }, 2000);
    }
    
    // Event listeners
    newNoteBtn.addEventListener('click', createNewNote);
    saveNoteBtn.addEventListener('click', saveCurrentNote);
    deleteNoteBtn.addEventListener('click', deleteCurrentNote);
    
    noteTitle.addEventListener('input', () => {
        updateCounts();
        scheduleAutoSave();
    });
    
    noteContent.addEventListener('input', () => {
        updateCounts();
        scheduleAutoSave();
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 's':
                    e.preventDefault();
                    saveCurrentNote();
                    break;
                case 'n':
                    e.preventDefault();
                    createNewNote();
                    break;
            }
        }
    });
    
    // Initialize
    loadNotes();
});
</script>
{% endblock %}
